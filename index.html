<html>
	<head>
		<script type="text/javascript" src="js/jquery.min.js"></script>
	</head>
	<body>
	
	<div id="Overview">
	</div>
	<script>
		var Seed = {};
		var cm = {};
		var signed_request = "ck0erczZOkEVDoHigHVw5obZyEpDR4-Zn9Nh8B9Yy50.eyJhbGdvcml0aG0iOiJITUFDLVNIQTI1NiIsImV4cGlyZXMiOjEzODAyMTQ4MDAsImlzc3VlZF9hdCI6MTM4MDIxMDI1MCwib2F1dGhfdG9rZW4iOiJDQUFBQUhseVpBcjlzQkFMQUNUMG8yU2xrNklJQjh3a2lFMmZ5dDVnQU1aQU9MOHlzeUJLREFiZHFSbFZheUVuR0dBTWhOSHVPVXYyVmFXR2JZMmJFcHVqT3BJVElNNGdBT0JaQ285aXRlM1VaQXY1ZGRvS05WVmRPa21ZajBwT2ppWkNlNjgzSGVoSlpBeFRnbFBON1NvRFpCbTJJVHoyZHUwZnFQd203WTQyTUZsOFZhbkNSeVhoRE1jQlZwanFPTUJSNHo5VVpDSERaQ0VnWkRaRCIsInVzZXIiOnsiY291bnRyeSI6InVzIiwibG9jYWxlIjoiZW5fVVMiLCJhZ2UiOnsibWluIjoxOCwibWF4IjoyMH19LCJ1c2VyX2lkIjoiNzc5MTE4NjIyIn0";
		var ts = (new Date().getTime() / 1000);
		var cts = parseInt( (ts - 25.1) * 1000);
		var server = 357;
//https://www357.kingdomsofcamelot.com/fb/e2/src/main_src.php?g=M&y=0&n=organic&l=en_US&messagebox=&sp=MTM3Mzk0MjE0OUtWRFKIs1_xOMk-&standalone=0&fbIframeOn=1&res=1&iframe=1&lang=en&appBar=&ts=1380210546.548&cts=1380210521448.0002&signed_request=ck0erczZOkEVDoHigHVw5obZyEpDR4-Zn9Nh8B9Yy50.eyJhbGdvcml0aG0iOiJITUFDLVNIQTI1NiIsImV4cGlyZXMiOjEzODAyMTQ4MDAsImlzc3VlZF9hdCI6MTM4MDIxMDI1MCwib2F1dGhfdG9rZW4iOiJDQUFBQUhseVpBcjlzQkFMQUNUMG8yU2xrNklJQjh3a2lFMmZ5dDVnQU1aQU9MOHlzeUJLREFiZHFSbFZheUVuR0dBTWhOSHVPVXYyVmFXR2JZMmJFcHVqT3BJVElNNGdBT0JaQ285aXRlM1VaQXY1ZGRvS05WVmRPa21ZajBwT2ppWkNlNjgzSGVoSlpBeFRnbFBON1NvRFpCbTJJVHoyZHUwZnFQd203WTQyTUZsOFZhbkNSeVhoRE1jQlZwanFPTUJSNHo5VVpDSERaQ0VnWkRaRCIsInVzZXIiOnsiY291bnRyeSI6InVzIiwibG9jYWxlIjoiZW5fVVMiLCJhZ2UiOnsibWluIjoxOCwibWF4IjoyMH19LCJ1c2VyX2lkIjoiNzc5MTE4NjIyIn0
		
		function new_seed(rslt){
			var mainSrcHTMLCode = rslt;
			var myregexp = /var seed=\{.*?\};/;                      
			var match = myregexp.exec(mainSrcHTMLCode);
			if (match != null) {
			
			 //logit("found match");
			 result = match[0];
			 result = result.substr(4);
			 
			 var seed2 = eval(result);
			 
			 for (jj in seed2) {
				if (seed2.hasOwnProperty(jj)) {
				   Seed[jj] = seed2[jj];
				}
			 }
			 console.log(Seed);
			//                         delete Seed.ss;

			 for (var o = 0; o < Seed.cities.length; o++) {
				var n = Seed.cities[o][0];
				Seed.citystats["city" + n].pop[0] = parseInt(Seed.citystats["city" + n].pop[0]);
				Seed.citystats["city" + n].pop[1] = parseInt(Seed.citystats["city" + n].pop[1]);
				Seed.citystats["city" + n].pop[2] = parseInt(Seed.citystats["city" + n].pop[2]);
				Seed.citystats["city" + n].gold[0] = parseInt(Seed.citystats["city" + n].gold[0]);
				Seed.citystats["city" + n].gold[1] = parseInt(Seed.citystats["city" + n].gold[1]);
				Seed.newTradeReports = parseInt(Seed.newTradeReports);
				for (var m = 1; m < 5; m++) {
				   Seed.resources["city" + n]["rec" + m][0] = parseInt(Seed.resources["city" + n]["rec" + m][0]);
				   Seed.resources["city" + n]["rec" + m][1] = parseInt(Seed.resources["city" + n]["rec" + m][1]);
				   Seed.resources["city" + n]["rec" + m][2] = parseInt(Seed.resources["city" + n]["rec" + m][2]);
				   Seed.resources["city" + n]["rec" + m][3] = parseInt(Seed.resources["city" + n]["rec" + m][3]);
				}
				var b = Seed.queue_con["city" + n];
				var d = unsafeWindow.Object.keys(Seed.buildings["city" + n]);
				for (var h = 0; h < b.length; h++) {
				   for (var m = 0; m < d.length; m++) {
					  if (Seed.buildings["city" + n][d[m]][3] == b[h][2]) {
						 b[h][7] = Seed.buildings["city" + n][d[m]][2];
						 break;
					  }
				   }
				}
			 }
			 if (Seed.queue_throne.length == 0) {
				Seed.queue_throne = {};
			 }
			}
		}
		
		//Build url
		var url = "https://www"+server+".kingdomsofcamelot.com/fb/e2/src/main_src.php?g=M&y=0&n=organic&l=en_US&messagebox=&sp=MTM3Mzk0MjE0OUtWRFKIs1_xOMk-&standalone=0&fbIframeOn=1&res=1&iframe=1&lang=en&appBar="+"&ts="+ts+"&cts="+cts+"&signed_request="+signed_request;
		
		console.log(url);
		
		$.ajax({
			url:url,
			success:function(rslt){new_seed(rslt);},
			error:function(xhr, status, error){
				console.log(xhr);
			}
		});

	function paintOverview (){
		var rownum = 0;
		var t = document.getElementById("Overview");
		//clearTimeout (Tabs.OverView.displayTimer);
		t.innerHTML = null;
		t.style.maxHeight = '650px';
		t.style.overflowX = Options.overviewAllowOverflow?'visible':'scroll';
		t.style.width = Options.overviewAllowOverflow?'':'745px';
		t.style.maxWidth = Options.overviewAllowOverflow?'':'745px';
		
		function _row (name, row, noTotal){
		  if (rownum++ % 2)
			style = '';
		  else
			style = ' style = "background: #e8e8e8"';
		  var tot = 0;
		  var m = [];
		  m.push ('<TR style="background: #fff" align=right');
		  m.push (style);
		  m.push ('><TD');
		  m.push (style);
		  m.push ('><B>');
		  m.push (name);
		  m.push (' &nbsp; </td>');
		  if (noTotal){
			m.push ('<TD');
			m.push (style);
			m.push ('> &nbsp;</td>');
		  } else {
			for (i=0; i<row.length; i++)
			  tot += row[i];
			m.push ('<TD style="background: #ffc">');
		  if (TEST_WIDE)
			  m.push ('X,');        
			m.push (addCommas(tot));
			m.push ('</td>');
		  }
		  for (i=0; i<row.length; i++){
			m.push ('<TD');
			m.push (style);
			m.push ('>');
		  if (TEST_WIDE)
			 m.push ('X,');        
			m.push (addCommas(row[i]));
			m.push ('</td>');
		  }
		  m.push ('</tr>');
		  return m.join('');
		}
    
	var Options = {
		includeMarching : false,
		includeTrainingExt : false
	}
    //DebugTimer.start(); 
    try {
      if (Options.includeMarching)
        march = getMarchInfo ();
      if (Options.includeTrainingExt)
        train = getTrainInfo ();
      dt = new Date ();
      dt.setTime (Seed.player.datejoinUnixTime * 1000);
              
      str = "<DIV id=overMainDiv style='font-size:"+ Options.overviewFontSize +"px'><TABLE class=ptTabOverview cellpadding=0 cellspacing=0><TR valign=top align=right><TD width=65></td><TD width=88 style='background: #ffc'><B>TOTAL</b></td>";
      for(i=0; i<Cities.numCities; i++) {
        str += "<TD width=81><B>"+ Cities.cities[i].name.substring(0,11) +'</b><BR>'+ coordLink (Cities.cities[i].x, Cities.cities[i].y) +"<BR>"+ unsafeWindow.provincenames['p'+ Cities.cities[i].provId] +"</td>";
      }
      if (Options.includeMarching)
        str += '<TD width=81><B>Marching</b></td>';
      if (Options.includeTrainingExt)
        str += '<TD width=81><B>Training</b></td>';
      str += "<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>";
  
    str += '<TR valign=top align=right><TD></td><TD style=\'background: #ffc\'></td>';
    for(i=0; i<Cities.numCities; i++){
      cityID = 'city'+Cities.cities[i].id;
      Gate = parseInt(Seed.citystats[cityID].gate);
    if(Gate == 0)
      str += '<TD>Hiding</td>';
    else
      str += '<TD><SPAN class=boldRed>Defending</span></td>';
    }

      rows = [];
      rows[0] = [];
      for(i=0; i<Cities.numCities; i++) {
        cityID = 'city'+ Cities.cities[i].id;
        rows[0][i] = parseInt(Seed.citystats[cityID].gold[0]);
      }
      for (r=1; r<5; r++){
        rows[r] = [];
        for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
          rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0] / 3600);
        }
      }
	  rows[5] = [];
	  for(i=0; i<Cities.numCities; i++) { //Aetherstone
        cityID = 'city'+ Cities.cities[i].id;
        rows[5][i] = parseInt(Seed.resources[cityID]['rec5'][0]);
      }
  
      if (Options.includeMarching){
        for (var i=0; i<5; i++)
          rows[i][Cities.numCities] = march.resources[i]; //Aetherstone does not show up in march info
      }
      str += _row ('Gold', rows[0]);
      str += _row ('Food', rows[1]);
      str += _row ('Wood', rows[2]);
      str += _row ('Stone', rows[3]);
      str += _row ('Ore', rows[4]);
      str += _row ('Aetherstone', rows[5]);
      str += '<TR><TD colspan=11><BR></td></tr>';
      for (r=1; r<nTroopType+1; r++){
        rows[r] = [];
        for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
          rows[r][i] = parseIntNan(Seed.units[cityID]['unt'+r]);
        }
      }
	  
	  var colnum = Cities.numCities;
      if (Options.includeMarching){
        for (var i=0; i<nTroopType+1; i++){
          rows[i][colnum] = parseIntNan(march.marchUnits[i]);
		}
		colnum++;
      }
	  if(Options.includeTrainingExt){
		for (var i=0; i<nTroopType+1; i++){
		  rows[i][colnum] = parseIntNan(train.trainUnts[i]);
		}
	  }
      if (Options.includeTraining){
        var q = Seed.queue_unt;
        for(i=0; i<Cities.numCities; i++) {
          q = Seed.queue_unt['city'+ Cities.cities[i].id];
          if (q && q.length>0){
            for (qi=0; qi<q.length; qi++)
              rows[q[qi][0]][i] += parseIntNan(q[qi][1]);
          }    
        }
      }
      rownum = 0;
      str += _row ('SupTrp', rows[1]);
      str += _row ('Militia', rows[2]);
      str += _row ('Scout', rows[3]);
      str += _row ('Pike', rows[4]);
      str += _row ('Sword', rows[5]);
      str += _row ('Archer', rows[6]);
      str += _row ('Cavalry', rows[7]);
      str += _row ('Heavy', rows[8]);
      str += _row ('Wagon', rows[9]);
      str += _row ('Ballista', rows[10]);
      str += _row ('Ram', rows[11]);
      str += _row ('Catapult', rows[12]);
      str += _row ('Bloodthorn', rows[13]);
      str += _row ('Executioner', rows[14]);
      str += _row ('Siege Wall', rows[15]);
      str += _row ('Flame Archer', rows[16]);
      str += _row ('Hussar', rows[17]);
      str += '<TR><TD colspan=11><BR></td></tr>';
      
      row = [];
      for(i=0; i<Cities.numCities; i++) {
        var rp = getResourceProduction (Cities.cities[i].id);
        var usage = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][3]);
	var bp = uW.cm.Resources.getProductionBase (1,Cities.cities[i].id);
//
// adjust for throne room bonuses
        var trupkeepreduce = 0;
        trupkeepreduce = Math.min(equippedthronestats(79), 33);
        var trprodres = equippedthronestats(82);
        var trprod = [0,0,0,0,0];
        trprod[1] = Math.min(equippedthronestats(83) + trprodres, 2000);
        var upkbase =  uW.cm.Resources.getUpkeep (1,Cities.cities[i].id)/(1-trupkeepreduce/100);
        usage = parseInt(usage - upkbase*trupkeepreduce/100);
        row[i] = parseInt(rp[1] - usage + bp*trprod[1]/100);
      }
     
      str += _row ('Food +/-', row, true);
      
      for(i=0; i<Cities.numCities; i++) {
        if (row[i] >= 0)
          row[i] = '----';
        else {
          var timeLeft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0]) / 3600 / (0-row[i]) * 3600;
          if (timeLeft > 86313600)
            row[i] = '----';
          else {
            if (Options.enableFoodWarn && timeLeft<(Options.foodWarnHours*3600))
              row[i] = '<SPAN class=whiteOnRed>'+ timestrShort(timeLeft) +'</span>';
            else
              row[i] = timestrShort(timeLeft);
          }
        }
      }    
      str += _row ('Food left', row, true);
      str += '<TR><TD><BR></td></tr>';
      
      row = [];
      for(i=0; i<Cities.numCities; i++) {
        var totWilds = 0;
        dat = Seed.wilderness['city'+ Cities.cities[i].id];
        if (dat!=null && matTypeof(dat)=='object')
          for (k in dat)
            ++totWilds;
        var castle = parseInt(Seed.buildings['city'+ Cities.cities[i].id].pos0[1]);
       if(castle == 11) castle = 12;
       else if(castle == 12) castle = 14;
        if (totWilds < castle)
          row[i] = '<SPAN class=boldRed><B>'+ totWilds +'/'+ castle +'</b></span>';
        else
          row[i] = totWilds +'/'+ castle;
      }
      str += _row ('#Wilds', row, true);
  
      row = [];
      for(i=0; i<Cities.numCities; i++) {
        totKnights = 0;
        dat = Seed.knights['city'+ Cities.cities[i].id];
        for (k in dat)
          ++totKnights;
        row[i] = totKnights;
      }
      str += _row ('#Knights', row, true);
  
      var now = unixTime();
      var row = [];
      var rowsp = [];
      var rowrev = [];

      for(i=0; i<Cities.numCities; i++) {
        var totTime = 0;
        var totTime2 = 0;
        var q = Seed.queue_unt['city'+Cities.cities[i].id]; 
        if (q!=null && q.length>0)
          totTime = q[q.length-1][3] - now;
        if (totTime < 0)
          totTime = 0;
	row[i] = 0;
	rowsp[i] = 0;
	if (q!=null && q.length>0) {
	  if (q[q.length-1][7]) {
	    row[i] = 0;
            if (totTime < 3600)
              rowsp[i] = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
            else
              rowsp[i] = timestr(totTime);
	  } else {
            if (totTime < 3600)
              row[i] = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
            else
              row[i] = timestr(totTime);
	    if (q.length>1) {
	     for (j=2; j<q.length+1; j++) {
	      if (q[q.length-j][7]) {
         	totTime2 = q[q.length-j][3] - now;
        	if (totTime2 < 0)
          	  totTime2 = 0;
        	if (totTime2 < 3600)
          	  rowsp[i] = '<SPAN class=boldRed><B>'+ timestr(totTime2) +'</b></span>';
        	else
          	  rowsp[i] = timestr(totTime2);
		break;
	       }
	     }
	   }
	 }
	}

        var qr = Seed.queue_revive['city'+Cities.cities[i].id]; 
        if (qr!=null && qr.length>0)
          totTime = qr[qr.length-1][3] - now;
        if (totTime < 0)
          totTime = 0;
	rowrev[i] = 0;
	if (qr!=null && qr.length>0) {
            if (totTime < 3600)
              rowrev[i] = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
            else
              rowrev[i] = timestr(totTime);
	}

      }

      str += _row ('TroopQ', row, true);
      str += _row ('SpecialTroopQ', rowsp, true);
      str += _row ('ReviveQ', rowrev, true);
      
      var row = [];
      for(i=0; i<Cities.numCities; i++) {
        var wall = {};
        getWallInfo (Cities.cities[i].id, wall);
        var totTime = 0;
        var q = Seed.queue_fort['city'+Cities.cities[i].id]; 
        if (q!=null && q.length>0)
          totTime = q[q.length-1][3] - now;
        if (totTime < 0)
          totTime = 0;
        if (totTime<1 && (wall.wallSpaceUsed < wall.wallSpace-4 || wall.fieldSpaceUsed < wall.fieldSpace-4))
          row[i] = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
        else
          row[i] = timestr(totTime);
      }    
      str += _row ('WallQue', row, true);
      str += '<TR><TD class=xtab></td><TD class=xtab colspan=4><BR><INPUT type=CHECKBOX id=idCheck'+ (Options.includeMarching?' CHECKED':'') +'>Include Marching Troops/Resources</td></tr>';
      str += '<TR><TD class=xtab></td><TD class=xtab colspan=4><INPUT type=CHECKBOX id=ptoverIncTrain'+ (Options.includeTraining?' CHECKED':'') +'>Include troops in training in cities</td></tr>';
      str += '<TR><TD class=xtab></td><TD class=xtab colspan=4><INPUT type=CHECKBOX id=ptoverIncTrainExt'+ (Options.includeTrainingExt?' CHECKED':'') +'>Include troops in training total</td></tr>';
      str += '<TR><TD class=xtab></td><TD class=xtab colspan=4><INPUT type=CHECKBOX id=ptOverOver'+ (Options.overviewAllowOverflow?' CHECKED':'') +'>Allow width overflow \
         &nbsp; &nbsp; FONT SIZE: '+ htmlSelector ({9:9, 10:10, 11:11, 12:12}, Options.overviewFontSize, 'id=ptoverfont') +'</td></tr><BR>';
      str += "</table></div>";
      str+= 'Koc Power Tools Version:' + Version;
      t.Overv.innerHTML = str;
      document.getElementById('idCheck').addEventListener('click', e_clickEnableMarch, false);
      document.getElementById('ptoverIncTrain').addEventListener('click', e_clickEnableTraining, false);
      document.getElementById('ptoverIncTrainExt').addEventListener('click', e_clickEnableTrainingExt, false);
      document.getElementById('ptOverOver').addEventListener('click', e_allowWidthOverflow, false);
      document.getElementById('ptoverfont').addEventListener('change', e_fontSize, false);
    //DebugTimer.display ('Draw Overview');    
    } catch (e){
      new CdialogCancelContinue ('<PRE>'+ inspect(e,3,1) +'</pre>', null, null, true);
      t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +' on '+ e.lineNumber +'</pre>';
    }   
    t.displayTimer = setTimeout (t.paintOld, 5000);	

    function e_clickEnableMarch (){
      var t = Tabs.OverView;
      Options.includeMarching = document.getElementById('idCheck').checked;
      t.paintOld ();
    }
    function e_clickEnableTraining (){
      var t = Tabs.OverView;
      Options.includeTraining = document.getElementById('ptoverIncTrain').checked;
      t.paintOld ();
    }
    function e_clickEnableTrainingExt (){
      var t = Tabs.OverView;
      Options.includeTrainingExt = document.getElementById('ptoverIncTrainExt').checked;
      t.paintOld ();
    }

    function e_fontSize(evt){
      document.getElementById('ptOverOutput').style.fontSize = evt.target.value +'px'; 
      Options.overviewFontSize = evt.target.value;
      t.paintOld ();
    }

    function e_allowWidthOverflow (evt){
      var t = Tabs.OverView;
      var tf = document.getElementById('ptOverOver').checked;
      Options.overviewAllowOverflow = tf;
      if (tf)
        t.Overv.style.overflowX = 'visible';
      else
        t.Overv.style.overflowX = 'auto';
      t.paintOld ();
    }
  }
  function setCities(){
  Cities.numCities = Seed.cities.length;
  Cities.cities = [];
  Cities.byID = {};
  for (i=0; i<Cities.numCities; i++){
    city = {};
    city.idx = i;
    city.id = parseInt(Seed.cities[i][0]);
    city.name = Seed.cities[i][1];
    city.x = parseInt(Seed.cities[i][2]);
    city.y = parseInt(Seed.cities[i][3]);
    city.tileId = parseInt(Seed.cities[i][5]);
    city.provId = parseInt(Seed.cities[i][4]);
	getTroopDefTrainEstimates('city'+ city.id, city);
    Cities.cities[i] = city;
    Cities.byID[Seed.cities[i][0]] = city;
  }
}

function getTroopDefTrainEstimates (cityID, city){
	var b = Seed.buildings[cityID];
	city.numCottages = 0;
	city.numBarracks = 0;
	city.maxBarracks = 0;
	city.totLevelsBarracks = 0;
	city.blacksmithLevel = 0;
	city.stableLevel = 0;
	city.workshopLevel = 0;
	city.wallLevel = 0;
	for (var j=1; j<33; j++){
		if (b['pos'+j]) {
			var bname = parseInt(b['pos'+j][0]);
			var blvl = parseInt(b['pos'+j][1]);
			switch(bname){
				case 13:
					city.numBarracks++;
					city.totLevelsBarracks += parseInt(blvl);
					if (blvl>city.maxBarracks) city.maxBarracks=blvl;
					break;
				case 5:
					city.numCottages++;
					break;
				case 15:
					city.blacksmithLevel = blvl;
					break;
				case 16:
					city.workshopLevel = blvl;
					break;
				case 17:
					city.stableLevel = blvl;
					break;
				case 19:
					city.wallLevel = blvl;
					break;
			}
		}
	}
	var isPrestige = getCityPrestige(city.id);
	if(isPrestige){
		city.blacksmithLevel = 12;
		city.workshopLevel = 12;
		city.stableLevel = 12;
	}
	var now = unixTime();
	city.marshallCombatScore = 0;
	var s = Seed.knights[cityID];
	if (s) {
		s = s["knt" + Seed.leaders[cityID].combatKnightId];
		if (s){
			city.marshallCombatScore = s.combat;
			if (s.combatBoostExpireUnixtime > now)
				city.marshallCombatScore *= 1.25;
		}
	}
	city.foremanBasePoliticsScore = 0;
	var s = Seed.knights[cityID];
	if (s) {
		s = s["knt" + Seed.leaders[cityID].politicsKnightId];
		if (s){
			city.foremanBasePoliticsScore = s.politics;
			if (s.politicsBoostExpireUnixtime > now)
				city.foremanBasePoliticsScore *= 1.25;
		}
	}

	city.loggingLevel = parseInt(Seed.tech["tch2"]);
	city.geometryLevel = parseInt(Seed.tech["tch5"]);
	city.eagleEyesLevel = parseInt(Seed.tech["tch6"]);
	city.poisonedEdgeLevel = parseInt(Seed.tech["tch8"]);
	city.metalAlloysLevel = parseInt(Seed.tech["tch9"]);
	city.featherweightPowderLevel = parseInt(Seed.tech["tch10"]);
	city.alloyHorseshoesLevel = parseInt(Seed.tech["tch12"]);
	city.fletchingLevel = parseInt(Seed.tech["tch13"]);
	city.giantsStrengthLevel = parseInt(Seed.tech["tch16"]);

	var bm = city.numBarracks + 0.1 * (city.totLevelsBarracks - city.numBarracks);
	var mf = city.marshallCombatScore / 200;
	var gf = city.geometryLevel / 10;
	var sf = city.stableLevel / 10;
	var wf = city.workshopLevel / 10;
	var isf = bm * (1 + mf + gf);
	var csf = bm * (1 + mf + gf + sf);
	var ssf = bm * (1 + mf + gf + sf + wf);
	var pf = city.foremanBasePoliticsScore / 200;
	var gsf = city.giantsStrengthLevel / 10;
	var dsf = 1 + pf + gsf;

	
	city.Troop1Time = ((city.maxBarracks > 0)?(50/isf):0);
	city.Troop2Time = city.Troop1Time/2;
	city.Troop3Time = ((city.maxBarracks > 1 && city.eagleEyesLevel > 0)?(100/isf):0);
	city.Troop4Time = ((city.maxBarracks > 1 && city.poisonedEdgeLevel > 0)?(150/isf):0);
	city.Troop5Time = ((city.maxBarracks > 2 && city.blacksmithLevel > 0 && city.metalAlloysLevel > 0)?(225/isf):0);
	city.Troop6Time = ((city.maxBarracks > 3 && city.fletchingLevel > 0)?(350/isf):0);
	city.Troop7Time = ((city.maxBarracks > 4 && city.stableLevel > 0 && city.alloyHorseshoesLevel > 0)?(500/csf):0);
	city.Troop8Time = ((city.maxBarracks > 6 && city.blacksmithLevel > 4 && city.stableLevel > 4 && city.alloyHorseshoesLevel > 4)?(1500/csf):0);
	city.Troop9Time = ((city.maxBarracks > 5 && city.stableLevel > 0 && city.workshopLevel > 2 && city.featherweightPowderLevel > 0)?(1000/ssf):0);
	city.Troop10Time = ((city.maxBarracks > 7 && city.stableLevel > 1 && city.workshopLevel > 4 && city.geometryLevel > 4 && city.fletchingLevel > 5)?(3000/ssf):0);
	city.Troop11Time = ((city.maxBarracks > 8 && city.blacksmithLevel > 4 && city.stableLevel > 2 && city.workshopLevel > 6 && city.metalAlloysLevel > 7 && city.geometryLevel > 6)?(4500/ssf):0);
	city.Troop12Time = ((city.maxBarracks > 9 && city.stableLevel > 1 && city.workshopLevel > 8 && city.geometryLevel > 9 && city.fletchingLevel > 9)?(6000/ssf):0);
	city.Def53Time = ((city.wallLevel > 5 && city.blacksmithLevel > 5 && city.fletchingLevel > 4)?(180/dsf):0);
	city.Def55Time = ((city.wallLevel > 7 && city.blacksmithLevel > 7 && city.fletchingLevel > 6 && city.geometryLevel > 6)?(135/dsf):0);
	city.Def60Time = ((city.wallLevel > 3 && city.blacksmithLevel > 3 && city.poisonedEdgeLevel > 1)?(90/dsf):0);
	city.Def61Time = ((city.wallLevel > 0 && city.metalAlloysLevel > 0)?(30/dsf):0);
	city.Def62Time = ((city.wallLevel > 1 && city.blacksmithLevel > 1 && city.loggingLevel > 1)?(60/dsf):0);
}
function getCityPrestige (cityId){
	return Seed.cityData.city[cityId].isPrestigeCity;
}
function getCityBuilding (cityId, buildingId){
  var b = Seed.buildings['city'+cityId];
  var ret = {count:0, maxLevel:0};
  for( var k in b){
	if(b[k] && b[k][0] == buildingId){
		++ret.count;
		if(parseInt(b[k][1]) > ret.maxLevel)
			ret.maxLevel = parseInt(b[k][1]);
	}
  }
  return ret;
}
	</script>
	</body>
</html>